# Duo Configuration YAML
displayName: "Duo"
icon: "PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2ZwogICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiCiAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIKICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxuczpzb2RpcG9kaT0iaHR0cDovL3NvZGlwb2RpLnNvdXJjZWZvcmdlLm5ldC9EVEQvc29kaXBvZGktMC5kdGQiCiAgIHhtbG5zOmlua3NjYXBlPSJodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy9uYW1lc3BhY2VzL2lua3NjYXBlIgogICB2ZXJzaW9uPSIxLjEiCiAgIGlkPSJzdmcyOSIKICAgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIKICAgd2lkdGg9IjEzMzIuNTIiCiAgIGhlaWdodD0iNDI5LjkzMzMyIgogICB2aWV3Qm94PSIwIDAgMTMzMi41MiA0MjkuOTMzMzIiCiAgIHNvZGlwb2RpOmRvY25hbWU9IkR1byBMb2dvIEdyZWVuLnN2ZyIKICAgaW5rc2NhcGU6dmVyc2lvbj0iMC45Mi4zICh1bmtub3duKSI+PG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhMzUiPjxyZGY6UkRGPjxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj48ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD48ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+PGRjOnRpdGxlPjwvZGM6dGl0bGU+PC9jYzpXb3JrPjwvcmRmOlJERj48L21ldGFkYXRhPjxkZWZzCiAgICAgaWQ9ImRlZnMzMyIgLz48c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEiCiAgICAgb2JqZWN0dG9sZXJhbmNlPSIxMCIKICAgICBncmlkdG9sZXJhbmNlPSIxMCIKICAgICBndWlkZXRvbGVyYW5jZT0iMTAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjE4NTMiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iMTAyNSIKICAgICBpZD0ibmFtZWR2aWV3MzEiCiAgICAgc2hvd2dyaWQ9ImZhbHNlIgogICAgIGlua3NjYXBlOnpvb209IjEuMjYyMjciCiAgICAgaW5rc2NhcGU6Y3g9IjY2Ni4yNjAwMSIKICAgICBpbmtzY2FwZTpjeT0iMjE0Ljk2NjY2IgogICAgIGlua3NjYXBlOndpbmRvdy14PSI2NyIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMjciCiAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMSIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJnMzciIC8+PGcKICAgICBpZD0iZzM3IgogICAgIGlua3NjYXBlOmdyb3VwbW9kZT0ibGF5ZXIiCiAgICAgaW5rc2NhcGU6bGFiZWw9Imlua19leHRfWFhYWFhYIgogICAgIHRyYW5zZm9ybT0ibWF0cml4KDEuMzMzMzMzMywwLDAsLTEuMzMzMzMzMywwLDQyOS45MzMzMykiPjxnCiAgICAgICBpZD0iZzM5IgogICAgICAgdHJhbnNmb3JtPSJzY2FsZSgwLjEpIj48cGF0aAogICAgICAgICBkPSJNIDE2MTIuMjUsLTAuMDExNzE4OCBIIC0wLjAwMzkwNjI1IFYgMTUzMS42MyBIIDMyMjIuNDkgQyAzMTgwLjQ4LDY3OC42NiAyNDc1LjYzLC0wLjAxMTcxODggMTYxMi4yNSwtMC4wMTE3MTg4IgogICAgICAgICBzdHlsZT0iZmlsbDojN2JjZDU0O2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpub25lIgogICAgICAgICBpZD0icGF0aDQxIgogICAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIiAvPjxwYXRoCiAgICAgICAgIGQ9Ik0gMTYxMi4yNSwzMjI0LjQ5IEggLTAuMDAzOTA2MjUgViAxNjkyLjg2IEggMzIyMi40OSBjIC00Mi4wMSw4NTIuOTYgLTc0Ni44NiwxNTMxLjYzIC0xNjEwLjI0LDE1MzEuNjMiCiAgICAgICAgIHN0eWxlPSJmaWxsOiM2M2M0M2Y7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOm5vbnplcm87c3Ryb2tlOm5vbmUiCiAgICAgICAgIGlkPSJwYXRoNDMiCiAgICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiIC8+PHBhdGgKICAgICAgICAgZD0ibSA4MzgzLjY4LDMyMjQuNDkgYyAtODYzLjM4LDAgLTE1NjguMjMsLTY3OC42NyAtMTYxMC4yMywtMTUzMS42MyBoIDMyMjAuNDggYyAtNDIuMDEsODUyLjk2IC03NDYuODYsMTUzMS42MyAtMTYxMC4yNSwxNTMxLjYzIgogICAgICAgICBzdHlsZT0iZmlsbDojNjNjNDNmO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpub25lIgogICAgICAgICBpZD0icGF0aDQ1IgogICAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIiAvPjxwYXRoCiAgICAgICAgIGQ9Ik0gODM4My42OCwtMC4wMTE3MTg4IEMgNzUyMC4zLC0wLjAxMTcxODggNjgxNS40NSw2NzguNjYgNjc3My40NSwxNTMxLjYzIEggOTk5My45MyBDIDk5NTEuOTIsNjc4LjY2IDkyNDcuMDcsLTAuMDExNzE4OCA4MzgzLjY4LC0wLjAxMTcxODgiCiAgICAgICAgIHN0eWxlPSJmaWxsOiM3YmNkNTQ7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOm5vbnplcm87c3Ryb2tlOm5vbmUiCiAgICAgICAgIGlkPSJwYXRoNDciCiAgICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiIC8+PHBhdGgKICAgICAgICAgZD0iTSAzMzg1LjcyLDMyMjQuNDkgViAxNjEyLjI0IEMgMzM4NS43Miw3NDguODU5IDQwNjQuMzksNDQuMDExNyA0OTE3LjM2LDIgViAzMjI0LjQ5IEggMzM4NS43MiIKICAgICAgICAgc3R5bGU9ImZpbGw6IzYzYzQzZjtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6bm9uemVybztzdHJva2U6bm9uZSIKICAgICAgICAgaWQ9InBhdGg0OSIKICAgICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIgLz48cGF0aAogICAgICAgICBkPSJNIDY2MTAuMjIsLTAuMDExNzE4OCBIIDUwNzguNTggViAzMjI0LjQ5IEggNjYxMC4yMiBWIDE2MTIuMjQgLTAuMDExNzE4OCIKICAgICAgICAgc3R5bGU9ImZpbGw6IzdiY2Q1NDtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6bm9uemVybztzdHJva2U6bm9uZSIKICAgICAgICAgaWQ9InBhdGg1MSIKICAgICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIgLz48L2c+PC9nPjwvc3ZnPg=="
description: "Duo as a System of Record"
address: "api-{{Input Required: Duo Hostname}}.duosecurity.com" # https://duo.com/docs/adminapi#api-details
defaultSyncFrequency: HOURLY
defaultSyncMinInterval: 1
defaultApiCallFrequency: SECONDLY
defaultApiCallMinInterval: 1
type: "Duo-1.0.0"
adapterConfig: "ewogICAgImFwaVZlcnNpb24iOiAidjEiCn0=" # {"apiVersion": "v1"}
auth:
  - basic: # https://duo.com/docs/adminapi#authentication
      username: "{{Input Required: Duo Integration Key}}"
      password: "{{Input Required: Duo Secret Key}}"
entities:
  # https://duo.com/docs/adminapi#retrieve-users
  User:
    displayName: User
    externalId: User
    description: User entity in Duo
    syncFrequency: HOURLY
    syncMinInterval: 1
    apiCallFrequency: SECONDLY
    apiCallMinInterval: 1
    pageSize: 100
    pagesOrderedById: false
    attributes:
      - name: user_id
        externalId: user_id
        type: String
        indexed: true
        uniqueId: true
      - name: alias1
        externalId: alias1
        type: String
      - name: alias2
        externalId: alias2
        type: String
      - name: alias3
        externalId: alias3
        type: String
      - name: alias4
        externalId: alias4
        type: String
      - name: created
        externalId: created
        type: DateTime # UNIX Timestamp
      - name: email
        externalId: email
        type: String
      - name: firstname
        externalId: firstname
        type: String
      - name: is_enrolled
        externalId: is_enrolled
        type: Bool
      - name: last_directory_sync
        externalId: last_directory_sync
        type: DateTime # UNIX Timestamp
      - name: last_login
        externalId: last_login
        type: DateTime # UNIX Timestamp
      - name: lastname
        externalId: lastname
        type: String
      - name: lockout_reason
        externalId: lockout_reason
        type: String
      - name: notes
        externalId: notes
        type: String
      - name: realname
        externalId: realname
        type: String
      - name: status
        externalId: status
        type: String
      - name: username
        externalId: username
        type: String
  # Fetched from the 'groups' attribute belonging to the Users entity.
  GroupMember:
    parent: User
    displayName: GroupMember
    externalId: groups
    description: Entity representing the Duo groups each user belongs to
    syncFrequency: HOURLY
    syncMinInterval: 1
    apiCallFrequency: SECONDLY
    apiCallMinInterval: 1
    pageSize: 100
    pagesOrderedById: false
    attributes:
      - name: group_id
        externalId: group_id
        type: String
        indexed: true
        uniqueId: true
      - name: name
        externalId: name
        type: String
  # Fetched from the 'phones' attribute belonging to the Users entity.
  PhoneOwner:
    parent: User
    displayName: PhoneOwner
    externalId: phones
    description: Entity representing the Duo phones owned by the User
    syncFrequency: HOURLY
    syncMinInterval: 1
    apiCallFrequency: SECONDLY
    apiCallMinInterval: 1
    pageSize: 100
    pagesOrderedById: false
    attributes:
      - name: phone_id
        externalId: phone_id
        type: String
        indexed: true
        uniqueId: true
      - name: name
        externalId: name
        type: String
  # https://duo.com/docs/adminapi#groups
  Group:
    displayName: Group
    externalId: Group
    description: Group entity in Duo
    syncFrequency: HOURLY
    syncMinInterval: 1
    apiCallFrequency: SECONDLY
    apiCallMinInterval: 1
    pageSize: 100
    pagesOrderedById: false
    attributes:
      - name: group_id
        externalId: group_id
        type: String
        indexed: true
        uniqueId: true
      - name: desc
        externalId: desc
        type: String
      - name: mobile_otp_enabled
        externalId: mobile_otp_enabled
        type: Bool
      - name: name
        externalId: name
        type: String
      - name: push_enabled
        externalId: push_enabled
        type: Bool
      - name: sms_enabled
        externalId: sms_enabled
        type: Bool
      - name: status
        externalId: status
        type: String
      - name: voice_enabled
        externalId: voice_enabled
        type: Bool
  # https://duo.com/docs/adminapi#phones
  Phone:
    displayName: Phone
    externalId: Phone
    description: Phone entity in Duo
    pageSize: 100
    pagesOrderedById: false
    attributes:
      - name: phone_id
        externalId: phone_id
        type: String
        indexed: true
        uniqueId: true
      - name: activated
        externalId: activated
        type: Bool
      - name: capabilities
        externalId: capabilities
        type: String
        list: true
      - name: encrypted
        externalId: encrypted
        type: String
      - name: extension
        externalId: extension
        type: String
      - name: fingerprint
        externalId: fingerprint
        type: String
      - name: last_seen 
        externalId: last_seen
        type: DateTime # RFC3339 Format
      - name: model
        externalId: model
        type: String
      - name: name
        externalId: name
        type: String
      - name: number
        externalId: number
        type: String
      - name: platform
        externalId: platform
        type: String
      - name: postdelay
        externalId: postdelay
        type: String
      - name: predelay
        externalId: predelay
        type: String
      - name: screenlock
        externalId: screenlock
        type: String
      - name: sms_passcodes_sent
        externalId: sms_passcodes_sent
        type: Bool
      - name: tampered
        externalId: tampered
        type: String
      - name: type
        externalId: type
        type: String
  # https://duo.com/docs/adminapi#retrieve-endpoints
  Endpoint:
    displayName: Endpoint
    externalId: Endpoint
    description: Endpoint entity in Duo
    pageSize: 100
    pagesOrderedById: false
    attributes:
      - name: epkey
        externalId: epkey
        type: String
        indexed: true
        uniqueId: true
      - name: computer_sid
        externalId: computer_sid
        type: String
      - name: cpu_id
        externalId: cpu_id
        type: String
      - name: device_id
        externalId: device_id
        type: String
      - name: device_identifier
        externalId: device_identifier
        type: String
      - name: device_identifier_type
        externalId: device_identifier_type
        type: String
      - name: device_name
        externalId: device_name
        type: String
      - name: device_udid
        externalId: device_udid
        type: String
      - name: device_username
        externalId: device_username
        type: String
      - name: device_username_type
        externalId: device_username_type
        type: String
      - name: disk_encryption_status
        externalId: disk_encryption_status
        type: String
      - name: domain_sid
        externalId: domain_sid
        type: String
      - name: email
        externalId: email
        type: String
      - name: firewall_status
        externalId: firewall_status
        type: String
      - name: hardware_uuid
        externalId: hardware_uuid
        type: String
      - name: health_app_client_version
        externalId: health_app_client_version
        type: String
      - name: health_data_last_collected
        externalId: health_data_last_collected
        type: DateTime # Unix Timestamp
      - name: last_updated
        externalId: last_updated
        type: DateTime # Unix Timestamp
      - name: machine_guid
        externalId: machine_guid
        type: String
      - name: model
        externalId: model
        type: String
      - name: os_build
        externalId: os_build
        type: String
      - name: os_family
        externalId: os_family
        type: String
      - name: os_version
        externalId: os_version
        type: String
      - name: password_status
        externalId: password_status
        type: String
      - name: trusted_endpoint
        externalId: trusted_endpoint
        type: String
      - name: type
        externalId: type
        type: String
      - name: username
        externalId: username
        type: String
relationships:
  ParentOfGroupMember:
    childEntity: groups
  ParentOfPhoneOwner:
    childEntity: phones
  MemberOfGroup:
    name: MemberOf
    fromAttribute: groups.group_id
    toAttribute: Group.group_id
  OwnerOfPhone:
    name: MemberOf
    fromAttribute: phones.phone_id
    toAttribute: Phone.phone_id
  UserMemberGroup:
    name: Group
    path:
      - relationship: ParentOfGroupMember
        direction: Backward
      - relationship: MemberOfGroup
        direction: Forward
  UserPhoneOwner:
    name: Phone
    path:
      - relationship: ParentOfPhoneOwner
        direction: Backward
      - relationship: OwnerOfPhone
        direction: Forward
